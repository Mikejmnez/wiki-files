<mediawiki xmlns="http://www.mediawiki.org/xml/export-0.11/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mediawiki.org/xml/export-0.11/ http://www.mediawiki.org/xml/export-0.11.xsd" version="0.11" xml:lang="en">
  <siteinfo>
    <sitename>OPeNDAP Documentation</sitename>
    <dbname>wikidb</dbname>
    <base>https://docs.opendap.org/index.php/Home</base>
    <generator>MediaWiki 1.38.4</generator>
    <case>first-letter</case>
    <namespaces>
      <namespace key="-2" case="first-letter">Media</namespace>
      <namespace key="-1" case="first-letter">Special</namespace>
      <namespace key="0" case="first-letter" />
      <namespace key="1" case="first-letter">Talk</namespace>
      <namespace key="2" case="first-letter">User</namespace>
      <namespace key="3" case="first-letter">User talk</namespace>
      <namespace key="4" case="first-letter">OPeNDAP Documentation</namespace>
      <namespace key="5" case="first-letter">OPeNDAP Documentation talk</namespace>
      <namespace key="6" case="first-letter">File</namespace>
      <namespace key="7" case="first-letter">File talk</namespace>
      <namespace key="8" case="first-letter">MediaWiki</namespace>
      <namespace key="9" case="first-letter">MediaWiki talk</namespace>
      <namespace key="10" case="first-letter">Template</namespace>
      <namespace key="11" case="first-letter">Template talk</namespace>
      <namespace key="12" case="first-letter">Help</namespace>
      <namespace key="13" case="first-letter">Help talk</namespace>
      <namespace key="14" case="first-letter">Category</namespace>
      <namespace key="15" case="first-letter">Category talk</namespace>
    </namespaces>
  </siteinfo>
  <page>
    <title>JoinNew Explicit Dataset Tutorial</title>
    <ns>0</ns>
    <id>583</id>
    <revision>
      <id>5920</id>
      <parentid>5589</parentid>
      <timestamp>2010-11-04T17:35:58Z</timestamp>
      <contributor>
        <username>Jimg</username>
        <id>3</id>
      </contributor>
      <comment>/* Autogenerated Uniform Numeric Values */</comment>
      <origin>5920</origin>
      <model>wikitext</model>
      <format>text/x-wiki</format>
      <text bytes="10482" sha1="2wfnsltn5j0jew318d08dnd1y2t6hsl" xml:space="preserve">=== Default Values for the New Coordinate Variable (on a Grid) ===
[[Category:Aggregation]]
[[Category:NCML]]

The default for the new coordinate variable is to be of type String with the location of the dataset as the value.  For example, the following NcML file:

&lt;pre&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="Simple test of joinNew Grid aggregation"&gt;
  
  &lt;aggregation type="joinNew" dimName="filename"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt; 
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt; 
    &lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt; 
    &lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;  
    &lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt; 
  &lt;/aggregation&gt; 
  
&lt;/netcdf&gt;
&lt;/pre&gt;

specifies an aggregation on a Grid variable '''dsp_band_1''' sampled in four HDF4 datasets listed explicitly.

First, the data structure (DDS) is:

&lt;pre&gt;
Dataset {
    Grid {
      Array:
        UInt32 dsp_band_1[filename = 4][lat = 1024][lon = 1024];
      Maps:
        String filename[filename = 4];
        Float64 lat[1024];
        Float64 lon[1024];
    } dsp_band_1;
    String filename[filename = 4];
} joinNew_grid.ncml;
&lt;/pre&gt;

We see the aggregated variable '''dsp_band_1''' has the new outer dimension ''filename''.  A coordinate variable ''filename[filename]' was created as a sibling of the aggregated variable (the top level Grid we specified) and was also copied into the aggregated Grid as a new map vector.

The ASCII data response for just the new coordinate variable ''filename[filename]'' is:

&lt;pre&gt;
String filename[filename = 4] = {"data/ncml/agg/grids/f97182070958.hdf", 
"data/ncml/agg/grids/f97182183448.hdf", 
"data/ncml/agg/grids/f97183065853.hdf", 
"data/ncml/agg/grids/f97183182355.hdf"};
&lt;/pre&gt;

We see that the absolute location we specified for the dataset as a String is the value for each element of the new coordinate variable.

The newly added map '''dsp_band_1.filename''' contains a copy of this data.

=== Explicitly Specifying the New Coordinate Variable ===

If the author wishes to have the new coordinate variable be of a specific data type with non-uniform values, then they must specify the new coordinate variable explicitly.

==== Array Virtual Dataset ====
Here's an example using a contrived pure virtual dataset:

&lt;pre&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="JoinNew on Array with Explicit Map"&gt;

  &lt;!-- joinNew and form new outer dimension "day" --&gt;
  &lt;aggregation type="joinNew" dimName="day"&gt;
    &lt;variableAgg name="V"/&gt;

    &lt;netcdf title="Slice 1"&gt;
      &lt;dimension name="sensors" length="3"/&gt;
      &lt;variable name="V" type="int" shape="sensors"&gt;
	&lt;values&gt;1 2 3&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf title="Slice 2"&gt;
      &lt;dimension name="sensors" length="3"/&gt;
      &lt;variable name="V" type="int" shape="sensors"&gt;
	&lt;values&gt;4 5 6&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

  &lt;!-- This is recognized as the definition of the new coordinate variable, 
       since it has the form day[day] where day is the dimName for the aggregation. 
       It MUST be specified after the aggregation, so that the dimension size of day
      has been calculated.
  --&gt;
  &lt;variable name="day" type="int" shape="day"&gt;
    &lt;!-- Note: metadata may be added here as normal! --&gt;
    &lt;attribute name="units" type="string"&gt;Days since 01/01/2010&lt;/attribute&gt;
    &lt;values&gt;1 30&lt;/values&gt;
  &lt;/variable&gt;
	     
&lt;/netcdf&gt;

&lt;/pre&gt;

The resulting DDS:

&lt;pre&gt;
Dataset {
    Int32 V[day = 2][sensors = 3];
    Int32 day[day = 2];
} joinNew_with_explicit_map.ncml;
&lt;/pre&gt;

and the ASCII data:

&lt;pre&gt;
Int32 V[day = 2][sensors = 3] = {{1, 2, 3},{4, 5, 6}};
Int32 day[day = 2] = {1, 30};
&lt;/pre&gt;

Note that the values we have explicitly given are used here as well as the specified NcML type, ''int'' which is mapped to a DAP Int32.  

If metadata is desired on the new coordinate variable, it may be added just as in a normal new variable declaration.  We'll give more examples of this later.

==== Grid with Explicit Map ====

Let's give one more example using a Grid to demonstrate the recognition of the coordinate variable as it is added to the Grid as the map vector for the new dimension:

&lt;pre&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Grid aggregation with explicit map"&gt;
  
  &lt;aggregation type="joinNew" dimName="sample_time"&gt;
    &lt;variableAgg name="dsp_band_1"/&gt; 
    &lt;netcdf location="data/ncml/agg/grids/f97182070958.hdf"/&gt; 
    &lt;netcdf location="data/ncml/agg/grids/f97182183448.hdf"/&gt; 
    &lt;netcdf location="data/ncml/agg/grids/f97183065853.hdf"/&gt;  
    &lt;netcdf location="data/ncml/agg/grids/f97183182355.hdf"/&gt; 
  &lt;/aggregation&gt; 
  
  &lt;!-- Note: values are contrived --&gt;
  &lt;variable name="sample_time" shape="sample_time" type="float"&gt;
    &lt;!-- Metadata here will also show up in the Grid map --&gt;
    &lt;attribute name="units" type="string"&gt;Days since 01/01/2010&lt;/attribute&gt;
    &lt;values&gt;100 200 400 1000&lt;/values&gt;
  &lt;/variable&gt;

&lt;/netcdf&gt;
&lt;/pre&gt;

This produces the DDS:

&lt;pre&gt;
Dataset {
    Grid {
      Array:
        UInt32 dsp_band_1[sample_time = 4][lat = 1024][lon = 1024];
      Maps:
        Float32 sample_time[sample_time = 4];
        Float64 lat[1024];
        Float64 lon[1024];
    } dsp_band_1;
    Float32 sample_time[sample_time = 4];
} joinNew_grid_explicit_map.ncml;
&lt;/pre&gt;

You can see the explicit coordinate variable '''sample_time''' was found as the sibling of the aggregated Grid as was added as the new map vector for the Grid.

The values for the projected coordinate variables are as expected:
&lt;pre&gt;
Float32 sample_time[sample_time = 4] = {100, 200, 400, 1000};
&lt;/pre&gt;

==== Errors ====

It is a Parse Error to:

* Give a different number of values for the explicit coordinate variable than their are specified datasets
* Specify the new coordinate variable prior to the &lt;aggregation&gt; element since the dimension size is not yet known


=== Autogenerated Uniform Numeric Values ===

If the number of datasets might vary (for example, if a &lt;scan&gt; element, described later, is used), but the values are uniform, the start/increment version of the &lt;values&gt; element may be used to generate the values for the new coordinate variable.  For example:

&lt;pre&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="JoinNew on Array with Explicit Autogenerated Map"&gt;

  &lt;aggregation type="joinNew" dimName="day"&gt;
    &lt;variableAgg name="V"/&gt;

    &lt;netcdf title="Slice 1"&gt;
      &lt;dimension name="sensors" length="3"/&gt;
      &lt;variable name="V" type="int" shape="sensors"&gt;
	&lt;values&gt;1 2 3&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

    &lt;netcdf title="Slice 2"&gt;
      &lt;dimension name="sensors" length="3"/&gt;
      &lt;variable name="V" type="int" shape="sensors"&gt;
	&lt;values&gt;4 5 6&lt;/values&gt;
      &lt;/variable&gt;
    &lt;/netcdf&gt;

  &lt;/aggregation&gt;

  &lt;!-- Explicit coordinate variable definition --&gt;
  &lt;variable name="day" type="int" shape="day"&gt;
    &lt;attribute name="units" type="string" value="days since 2000-01-01 00:00"/&gt;
    &lt;!-- We sample once a week... --&gt;
    &lt;values start="1" increment="7"/&gt;
  &lt;/variable&gt;
	     
&lt;/netcdf&gt;
&lt;/pre&gt;

The DDS is the same as before and the coordinate variable is generated as expected:

&lt;pre&gt;
Int32 sample_time[sample_time = 4] = {1, 8, 15, 22};
&lt;/pre&gt;

Note that this form is useful for uniform sampled datasets (or if only a numeric index is desired) where the variable need not be changed as datasets are added.  It is especially useful for a &lt;scan&gt; element that refers to a dynamic number of files that can be described with a uniformly varying index.

=== Explicitly Using coordValue Attribute of &lt;netcdf&gt; ===

The ''netcdf@coordValue'' may be used to specify the value for the given dataset right where the dataset is declared.  This attribute will cause a coordinate variable to be automatically generated with the given values for each dataset filled in.  The new coordinate variable will be of type '''double''' if the coordValue's can all be parsed as a number, otherwise they will be of type '''String'''.

==== String coordValue Example ====

&lt;pre&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Aggregation with explicit string coordValue"&gt;
  
  &lt;aggregation type="joinNew" dimName="source"&gt;
    &lt;variableAgg name="u"/&gt;
    &lt;variableAgg name="v"/&gt;

    &lt;!-- Same dataset a few times, but with different coordVal --&gt;
    &lt;netcdf title="Dataset 1" location="data/ncml/fnoc1.nc" coordValue="Station_1"/&gt;
    &lt;netcdf title="Dataset 2" location="data/ncml/fnoc1.nc" coordValue="Station_2"/&gt;
    &lt;netcdf title="Dataset 3" location="data/ncml/fnoc1.nc" coordValue="Station_3"/&gt;
  &lt;/aggregation&gt;

&lt;/netcdf&gt;

&lt;/pre&gt;

This results in the following DDS:

&lt;pre&gt;
Dataset {
    Int16 u[source = 3][time_a = 16][lat = 17][lon = 21];
    Int16 v[source = 3][time_a = 16][lat = 17][lon = 21];
    Float32 lat[lat = 17];
    Float32 lon[lon = 21];
    Float32 time[time = 16];
    String source[source = 3];
} joinNew_string_coordVal.ncml;
&lt;/pre&gt;

and ASCII data response of the projected coordinate variable is:

&lt;pre&gt;
String source[source = 3] = {"Station_1", "Station_2", "Station_3"};
&lt;/pre&gt;

as we specified.

==== Numeric (double) Use of coordValue ====

If the first ''coordValue'' can be successfully parsed as a double numeric type, then a coordinate variable of type double (Float64) is created and all remaining ''coordValue'' specifications '''must''' be parsable as a double or a Parse Error is thrown.

Using the same example but with numbers instead:

&lt;pre&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;netcdf title="joinNew Aggregation with numeric coordValue"&gt;
  
  &lt;aggregation type="joinNew" dimName="source"&gt;
    &lt;variableAgg name="u"/&gt;
    &lt;variableAgg name="v"/&gt;

    &lt;!-- Same dataset a few times, but with different coordVal --&gt;
    &lt;netcdf title="Dataset 1" location="data/ncml/fnoc1.nc" coordValue="1.2"/&gt;
    &lt;netcdf title="Dataset 2" location="data/ncml/fnoc1.nc" coordValue="3.4"/&gt;
    &lt;netcdf title="Dataset 3" location="data/ncml/fnoc1.nc" coordValue="5.6"/&gt;

  &lt;/aggregation&gt;
&lt;/netcdf&gt;
&lt;/pre&gt;

This time we see that a Float64 array is created:

&lt;pre&gt;
Dataset {
    Int16 u[source = 3][time_a = 16][lat = 17][lon = 21];
    Int16 v[source = 3][time_a = 16][lat = 17][lon = 21];
    Float32 lat[lat = 17];
    Float32 lon[lon = 21];
    Float32 time[time = 16];
    Float64 source[source = 3];
} joinNew_numeric_coordValue.ncml;
&lt;/pre&gt;

The values we specified are in the coordinate variable ASCII data:

&lt;pre&gt;
Float64 source[source = 3] = {1.2, 3.4, 5.6};
&lt;/pre&gt;</text>
      <sha1>2wfnsltn5j0jew318d08dnd1y2t6hsl</sha1>
    </revision>
  </page>
</mediawiki>
